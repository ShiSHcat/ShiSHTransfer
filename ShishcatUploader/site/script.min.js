function onTelegramAuth(e){localStorage.setItem("tgauth",JSON.stringify(e)),window.sfstartws()}"https:"!==location.protocol&&location.replace(`https:${location.href.substring(location.protocol.length)}`),window.idfilesmap={},Dropzone.options.upload={createImageThumbnails:!1,paramName:"file",maxFilesize:107374182400,timeout:0,sending:function(e,t){console.log(e),t.setRequestHeader("upload-filename",e.name),""!=e.type?t.setRequestHeader("Content-Type",e.type):t.setRequestHeader("Content-Type","application/octet-stream");var i=t.send;t.send=function(){i.call(t,e)}},success:function(e,t){if(0!=t)try{for(var i="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,a=0;a<8;a++)i+=n.charAt(Math.floor(Math.random()*o));sfile={},sfile.size=e.size,sfile.name=e.name;let l={server_resp:t,file:sfile};window.idfilesmap[i]=l,localStorage.setItem(i,JSON.stringify(window.idfilesmap[i])),window.mkfilepreview(e,this,i,!1)}catch(e){console.log(e),alert("upload failed")}},init:function(){if(window.dzthis=this,localStorage.getItem("tgauth"))window.sfstartws();else for(lsz in localStorage)window.addfakefile(lsz)}},window.refsloaded=!1,window.sfstartws=function(){window.s_ws=new ReconnectingWebSocket("wss://"+window.location.hostname+"/ref");let e=localStorage.getItem("tgauth"),t=JSON.parse(e);window.s_ws.onopen=function(){window.s_ws.send(e)},window.s_ws.onmessage=function(e){var i=JSON.parse(e.data);if(0==i.op)return alert("Wrong telegram data."),void localStorage.removeItem("tgauth");if(1==i.op){let e=window.__strings.loggedas(t.first_name);document.getElementById("tgauth").innerHTML=`<p>${e}</p>`}else if(3==i.op){try{window.dzthis.removeFile(i.deleted_file_id)}catch(e){}delete window.idfilesmap[i.deleted_file_id]}else 2!=i.op||window.refsloaded||(window.idfilesmap[i.file.id]={file:{name:i.file.fname,size:i.file.size},server_resp:i.file},window.addfakefile_(i.file.id,window.idfilesmap[i.file.id]))}},window.addfakefile_=function(e,t){let i=localStorage.getItem(e);i&&i.server_resp&&(i.file.status=Dropzone.SUCCESS,i.file.accepted=!0,window.dzthis.emit("addedfile",i.file),window.dzthis.emit("complete",i.file),console.log("b",window.dzthis.files.push(i.file)),window.idfilesmap[e]=i,window.mkfilepreview(i.file,window.dzthis,e,t))},window.mkfilepreview=function(e,t,i,n){let o=window.idfilesmap[i];o=o.server_resp,console.log(o);let a=`https://${window.location.hostname}/f/${o.fLink}`,l=document.createElement("a");l.setAttribute("href",a),l.setAttribute("target","_blank"),l.innerHTML=`<br>${window.__strings.dl}`,e.previewTemplate.style.textAlign="center",e.previewTemplate.appendChild(l);let s=`https://${window.location.hostname}/delete/${o.hash}`;l=document.createElement("a"),console.log(s,i),l.addEventListener("click",async function(e){if(confirm(window.__strings.delconf))if(zre=await(await fetch(s)).json(),zre.ok){if(!n)return localStorage.removeItem(i),t.removeFile(window.idfilesmap[i].file),void delete window.idfilesmap[i];if(zre=await(await fetch(`https://${window.location.hostname}/delRef/${i}?${new URLSearchParams(n).toString()}`)).json(),!zre.ok)return alert("Error.")}else alert("Error.")}),l.setAttribute("href","#"),l.innerHTML=`<br><br>${window.__strings.delfile}`,e.previewTemplate.style.textAlign="center",e.previewTemplate.appendChild(l)},document.addEventListener("DOMContentLoaded",async function(){let e=await(await fetch("/stats")).json();document.getElementById("dsal").innerHTML=e.bandwidth,document.getElementById("dsala").innerHTML=e.storage},!1);